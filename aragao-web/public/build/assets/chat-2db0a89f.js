Alpine.data("pageChat",()=>({chats:[],chatSelected:null,activeChat:!1,messages:[],modalUsuarios:!1,typeUsuarios:{admin:"Admin",engineer:"Profissional",client:"Cliente"},modalImageSrc:null,modalImage:null,init(){this.getChats()},orderChat(){this.chats.sort((e,t)=>{var a,l;let s=new Date((a=e==null?void 0:e.last_message)==null?void 0:a.created_at);return new Date((l=t==null?void 0:t.last_message)==null?void 0:l.created_at)-s})},scrollChat(){let e=document.querySelector("#container-messages");setTimeout(()=>e.scroll(0,e.scrollHeight),50)},getChats(){Livewire.first().getChats().then(t=>{t&&(this.chats=t,this.orderChat())})},initChat(e){this.closeChat();let t=Livewire.first();t.idChatMessange=e.id,t.messagesFromChat().then(s=>{this.messages=s,this.scrollChat()}),e.unviewed_messages_count=0,this.chatSelected=e,this.activeChat=!0},closeChat(){let e=Livewire.first();e.idChatMessange=null,e.novoChat=!1,e.novoChatUser=null,this.chatSelected=null,this.activeChat=!1,this.messages=[],document.querySelector("#images-chat").value=""},inputSendMessage(e){e.key==="Enter"&&e.keyCode===13&&this.sendMessage()},async sendMessage(){var t;let e=Livewire.first();(e.inputMessage===null||((t=e.inputMessage)==null?void 0:t.trim())==="")&&e.imagesChat.length==0||e.messageStore().then(s=>{s&&(e.inputMessage=null,Array.isArray([s])?this.messages=this.messages.concat(s):this.messages.push(s),this.chatSelected.last_message=this.messages[this.messages.length-1],this.orderChat(),this.scrollChat(),document.querySelector("#images-chat").value="")})},initials(e){if(!e)return;let t=e.split(" ");return t[0][0]+(t[1]?t[1][0]:"")},initChatUser(e){this.closeChat();let t=this.chats.find(i=>{var a;return((a=i==null?void 0:i.usuario)==null?void 0:a.id)==(e==null?void 0:e.id)});if(t){this.initChat(t),this.modalUsuarios=!1;return}let s=Livewire.first();s.novoChat=!0,s.novoChatUser=e.id,this.activeChat=!0,this.chatSelected={tipo:"private",usuario:e},this.modalUsuarios=!1},eventNovoChatSelected(e){this.chatSelected=Object.assign({},e.detail[0]),this.chats.unshift(Object.assign({},e.detail[0])),this.orderChat();let t=Livewire.first();t.idChatMessange=this.chatSelected.id},closeModalImagesChat(){Livewire.first().resetImagesChat(),document.querySelector("#images-chat").value=""},setModalImage(e){this.modalImageSrc=e,this.modalImage=!0}}));
